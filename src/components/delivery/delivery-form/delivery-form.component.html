

<div class="container">
  <div class="page-header">
    <h2>{{ pageTitle() }}</h2>
    <a routerLink="/deliveries" class="back-link">
      <mat-icon>arrow_back</mat-icon>
      <span>العودة إلى جدول التسليم</span>
    </a>
  </div>

  <div class="card">
    <form [formGroup]="deliveryForm" (ngSubmit)="saveDelivery()">
      
      <!-- Invoice & Customer Summary -->
      @if (selectedInvoice(); as inv) {
        <section class="form-section summary-box">
            <h3 class="form-section-title">تفاصيل الفاتورة والعميل</h3>
            <div class="summary-grid">
                <div>
                    <p class="summary-label">رقم الفاتورة:</p>
                    <p class="summary-value font-mono">{{ inv.invoiceNumber }}</p>
                </div>
                <div>
                    <p class="summary-label">العميل:</p>
                    <p class="summary-value">{{ inv.customerName }}</p>
                </div>
                <div>
                    <p class="summary-label">السيارة:</p>
                    <p class="summary-value">{{ inv.items[0]?.carDescription || 'غير محدد' }}</p>
                </div>
                <div>
                    <p class="summary-label">تاريخ البيع:</p>
                    <p class="summary-value">{{ inv.invoiceDate | date:'yyyy-MM-dd' }}</p>
                </div>
            </div>
        </section>
      }

      <!-- Scheduling Details -->
      <section class="form-section">
        <h3 class="form-section-title">تفاصيل الجدولة</h3>
        <ng-container *ngIf="layout$ | async as layout">
          <mat-grid-list [cols]="layout.columns" rowHeight="100px" gutterSize="16px">
            <mat-grid-tile [colspan]="1" [rowspan]="1">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>تاريخ التسليم</mat-label>
                <input matInput type="date" formControlName="scheduledDate" required>
              </mat-form-field>
            </mat-grid-tile>
            <mat-grid-tile [colspan]="1" [rowspan]="1">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>وقت التسليم</mat-label>
                <input matInput type="time" formControlName="scheduledTime" required>
              </mat-form-field>
            </mat-grid-tile>
            <mat-grid-tile [colspan]="1" [rowspan]="1">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>الموظف المسؤول</mat-label>
                <mat-select formControlName="deliveryAgentId" required>
                  <mat-option [value]="null" disabled>-- اختر الموظف --</mat-option>
                  @for(salesperson of salespeople(); track salesperson.id) {
                    <mat-option [value]="salesperson.id">{{ salesperson.name }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </mat-grid-tile>
          </mat-grid-list>
        </ng-container>
      </section>

      <!-- Notes -->
      <section class="form-section">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>ملاحظات (اختياري)</mat-label>
          <textarea matInput formControlName="notes" rows="3" placeholder="ملاحظات إضافية حول عملية التسليم..."></textarea>
        </mat-form-field>
      </section>

      <!-- Form Actions -->
      <div class="form-actions">
        <a routerLink="/deliveries" mat-button>إلغاء</a>
        <button mat-raised-button color="primary" type="submit" [disabled]="deliveryForm.invalid">
          <mat-icon>schedule</mat-icon>
          جدولة التسليم
        </button>
      </div>
    </form>
  </div>
</div>
    