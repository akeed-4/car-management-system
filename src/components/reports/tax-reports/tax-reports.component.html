<div class="container mx-auto">
  <h2 class="text-xl font-semibold text-gray-800 mb-6">التقرير الضريبي للمبيعات</h2>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="bg-white p-6 rounded-lg shadow-md">
      <p class="text-sm font-medium text-gray-500">إجمالي المبيعات (قبل الضريبة)</p>
      <p class="text-2xl font-bold text-gray-800 mt-1">{{ totalSubtotal() | currency:'SAR':'symbol':'1.0-2' }}</p>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <p class="text-sm font-medium text-gray-500">إجمالي ضريبة القيمة المضافة</p>
      <p class="text-2xl font-bold text-orange-600 mt-1">{{ totalVatAmount() | currency:'SAR':'symbol':'1.0-2' }}</p>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <p class="text-sm font-medium text-gray-500">الإجمالي الشامل (مع الضريبة)</p>
      <p class="text-2xl font-bold text-blue-600 mt-1">{{ grandTotal() | currency:'SAR':'symbol':'1.0-2' }}</p>
    </div>
  </div>

  <!-- Detailed Invoices Table -->
  <div class="bg-white p-6 rounded-lg shadow-md">
     <h3 class="text-xl font-semibold text-gray-700 mb-4">تفاصيل فواتير المبيعات</h3>
     <div class="mb-4">
      <input 
        type="text" 
        placeholder="ابحث عن فاتورة (الرقم، العميل، التاريخ...)"
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 transition duration-150 ease-in-out text-sm"
        (input)="onFilter($event)">
    </div>
     <div class="overflow-x-auto">
      <table class="min-w-full bg-white">
        <thead class="bg-gray-50">
          <tr>
            <th class="text-right py-3 px-4 font-semibold text-sm text-gray-600 uppercase cursor-pointer" (click)="onSort('invoiceNumber')">
              رقم الفاتورة {{ getSortIcon('invoiceNumber') }}
            </th>
            <th class="text-right py-3 px-4 font-semibold text-sm text-gray-600 uppercase cursor-pointer" (click)="onSort('invoiceDate')">
              التاريخ {{ getSortIcon('invoiceDate') }}
            </th>
            <th class="text-right py-3 px-4 font-semibold text-sm text-gray-600 uppercase cursor-pointer" (click)="onSort('customerName')">
              العميل {{ getSortIcon('customerName') }}
            </th>
            <th class="text-right py-3 px-4 font-semibold text-sm text-gray-600 uppercase cursor-pointer" (click)="onSort('subtotal')">
              المبلغ قبل الضريبة {{ getSortIcon('subtotal') }}
            </th>
            <th class="text-right py-3 px-4 font-semibold text-sm text-gray-600 uppercase cursor-pointer" (click)="onSort('vatAmount')">
              مبلغ الضريبة {{ getSortIcon('vatAmount') }}
            </th>
            <th class="text-right py-3 px-4 font-semibold text-sm text-gray-600 uppercase cursor-pointer" (click)="onSort('totalAmount')">
              الإجمالي {{ getSortIcon('totalAmount') }}
            </th>
          </tr>
        </thead>
        <tbody class="text-gray-700">
          @for (invoice of filteredAndSortedInvoices(); track invoice.id) {
            <tr class="border-b hover:bg-gray-50">
              <td class="py-3 px-4 text-sm font-mono whitespace-nowrap">{{ invoice.invoiceNumber }}</td>
              <td class="py-3 px-4 text-sm whitespace-nowrap">{{ invoice.invoiceDate | date:'yyyy-MM-dd' }}</td>
              <td class="py-3 px-4 text-sm whitespace-nowrap">{{ invoice.customerName }}</td>
              <td class="py-3 px-4 text-sm font-mono whitespace-nowrap">{{ invoice.subtotal | currency:'SAR' }}</td>
              <td class="py-3 px-4 text-sm font-mono whitespace-nowrap">{{ invoice.vatAmount | currency:'SAR' }}</td>
              <td class="py-3 px-4 text-sm font-mono whitespace-nowrap font-bold">{{ invoice.totalAmount | currency:'SAR' }}</td>
            </tr>
          } @empty {
            <tr>
              <td colspan="6" class="text-center py-8 text-gray-500">
                لا توجد فواتير مبيعات مسجلة لعرض التقرير الضريبي.
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>