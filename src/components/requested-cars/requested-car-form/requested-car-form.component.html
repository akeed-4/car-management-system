<div class="container mx-auto">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-semibold text-gray-800">{{ pageTitle() }}</h2>
    <a routerLink="/requested-cars" class="text-primary-600 hover:text-primary-800 transition duration-300">&larr; العودة إلى قائمة الطلبات</a>
  </div>

  <div class="bg-white p-8 rounded-lg shadow-md max-w-3xl mx-auto">
    <form #requestForm="ngForm" (ngSubmit)="saveRequest()">
      
      <!-- Customer Info -->
      <section class="mb-8">
        <h3 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">بيانات العميل</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="customerName" class="block text-sm font-medium text-gray-700">اسم العميل</label>
            <input type="text" id="customerName" name="customerName" [ngModel]="request().customerName" (ngModelChange)="updateRequestField('customerName', $event)" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500">
          </div>
          <div>
            <label for="customerPhone" class="block text-sm font-medium text-gray-700">رقم الجوال</label>
            <input type="tel" id="customerPhone" name="customerPhone" [ngModel]="request().customerPhone" (ngModelChange)="updateRequestField('customerPhone', $event)" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500">
          </div>
        </div>
      </section>

      <!-- Car Info -->
      <section class="mb-8">
        <h3 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">مواصفات السيارة المطلوبة</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
            <label for="make" class="block text-sm font-medium text-gray-700">الشركة المصنعة</label>
            <select id="make" name="make" [ngModel]="request().make" (ngModelChange)="updateRequestField('make', $event)" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500">
                <option value="" disabled>-- اختر الشركة --</option>
                @for(m of manufacturers(); track m.id) {
                    <option [value]="m.name">{{m.name}}</option>
                }
            </select>
          </div>
          <div>
            <label for="model" class="block text-sm font-medium text-gray-700">الموديل</label>
            <select id="model" name="model" [ngModel]="request().model" (ngModelChange)="updateRequestField('model', $event)" required [disabled]="!request().make" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 disabled:bg-gray-100">
              <option [ngValue]="undefined" disabled>-- اختر الموديل --</option>
              @for (carModel of filteredModels(); track carModel.id) {
                <option [value]="carModel.name">{{ carModel.name }}</option>
              }
            </select>
          </div>
          <div>
            <label for="year" class="block text-sm font-medium text-gray-700">سنة الصنع (اختياري)</label>
            <select id="year" name="year" [ngModel]="request().year" (ngModelChange)="updateRequestField('year', +$event)" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500">
              <option [ngValue]="undefined">-- اختر السنة --</option>
              @for (y of years(); track y) {
                <option [value]="y">{{ y }}</option>
              }
            </select>
          </div>
          <div>
            <label for="color" class="block text-sm font-medium text-gray-700">اللون (اختياري)</label>
            <input type="text" id="color" name="color" [ngModel]="request().color" (ngModelChange)="updateRequestField('color', $event)" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500">
          </div>
           <div class="md:col-span-2">
            <label for="status" class="block text-sm font-medium text-gray-700">حالة الطلب</label>
             <select id="status" name="status" [ngModel]="request().status" (ngModelChange)="updateRequestField('status', $event)" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500">
              <option value="New">جديد</option>
              <option value="Contacted">تم التواصل</option>
              <option value="Sourced">تم توفيرها</option>
              <option value="Closed">مغلق</option>
            </select>
          </div>
          <div class="md:col-span-3">
            <label for="notes" class="block text-sm font-medium text-gray-700">ملاحظات إضافية</label>
            <textarea id="notes" name="notes" rows="3" [ngModel]="request().notes" (ngModelChange)="updateRequestField('notes', $event)" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"></textarea>
          </div>
        </div>
      </section>

      <!-- Form Actions -->
      <div class="mt-8 pt-6 border-t flex justify-end">
        <a routerLink="/requested-cars" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-lg shadow hover:bg-gray-300 transition duration-300 ml-4 text-sm">إلغاء</a>
        <button type="submit" [disabled]="requestForm.invalid" class="bg-primary-600 text-white px-6 py-2 rounded-lg shadow hover:bg-primary-700 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed text-sm">
          {{ editMode() ? 'حفظ التغييرات' : 'حفظ الطلب' }}
        </button>
      </div>
    </form>
  </div>
</div>
