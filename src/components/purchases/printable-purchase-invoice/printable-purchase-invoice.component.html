<div class="bg-white p-4 md:p-8 font-sans">
  @if (invoice(); as inv) {
    <div class="max-w-4xl mx-auto border rounded-lg p-6 md:p-10 shadow-lg">
      <!-- Header with Logo -->
       <header class="flex justify-between items-start pb-5 mb-5 border-b-2 border-gray-100">
        <div class="flex items-center">
          <div class="text-primary-600">
            <svg class="w-10 h-10" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 0 1-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h1.125c.621 0 1.125-.504 1.125-1.125V14.25m-17.25 4.5v-1.875a3.375 3.375 0 0 1 3.375-3.375h9.75a3.375 3.375 0 0 1 3.375 3.375v1.875m-17.25 4.5h14.25m-14.25 0h14.25m-14.25 0V11.25A2.25 2.25 0 0 1 5.625 9h12.75a2.25 2.25 0 0 1 2.25 2.25v3.75m-17.25 0h14.25M9 12.75h6m-6 0a1.5 1.5 0 0 1-1.5-1.5V8.625c0-.828.672-1.5 1.5-1.5h6c.828 0 1.5.672 1.5 1.5v2.625a1.5 1.5 0 0 1-1.5 1.5m-6 0h6" />
            </svg>
          </div>
          <div class="mr-4">
            <h1 class="text-lg font-bold text-gray-800">{{ companyInfo.name }}</h1>
            <p class="text-xs text-gray-500">{{ companyInfo.address }}</p>
            <p class="text-xs text-gray-500">س.ت: {{ companyInfo.crNumber }}</p>
          </div>
        </div>
        <div class="text-left">
          <h2 class="text-lg font-bold text-primary-700">فاتورة شراء</h2>
          <p class="text-sm text-gray-500">تاريخ: <span class="font-mono">{{ inv.invoiceDate | date:'yyyy-MM-dd' }}</span></p>
        </div>
      </header>

      <!-- Supplier Info -->
      <section class="mb-8">
        <h3 class="text-sm font-semibold text-gray-500 mb-2 uppercase">بيانات المورد:</h3>
        @if(supplier(); as sup) {
          <div class="text-sm">
            <p class="font-bold text-gray-800">{{ sup.name }}</p>
            <p class="text-xs text-gray-600">{{ sup.address }}</p>
            <p class="text-xs text-gray-600">الهاتف: {{ sup.phone }}</p>
            <p class="text-xs text-gray-600">س.ت: {{ sup.crNumber }}</p>
          </div>
        }
      </section>

      <!-- Items Table -->
      <section class="mb-8">
        <table class="w-full text-sm">
          <thead class="bg-primary-50 text-primary-800">
            <tr>
              <th class="text-right p-3 font-semibold text-sm rounded-r-lg">البيان</th>
              <th class="text-center p-3 font-semibold text-sm whitespace-nowrap">الكمية</th>
              <th class="text-left p-3 font-semibold text-sm whitespace-nowrap">سعر الوحدة</th>
              <th class="text-left p-3 font-semibold text-sm rounded-l-lg whitespace-nowrap">الإجمالي</th>
            </tr>
          </thead>
          <tbody>
            @for(item of inv.items; track item.carId) {
              <tr class="border-b align-top">
                <td class="p-3 text-sm align-top">
                  <p class="font-semibold text-gray-800">{{ item.carDescription }}</p>
                </td>
                <td class="p-3 text-center align-top">{{ item.quantity }}</td>
                <td class="p-3 text-left font-mono text-sm whitespace-nowrap align-top">{{ item.unitPrice | currency:'SAR' }}</td>
                <td class="p-3 text-left font-mono text-sm whitespace-nowrap align-top">{{ item.lineTotal | currency:'SAR' }}</td>
              </tr>
            }
          </tbody>
        </table>
      </section>

      <!-- Financial Summary -->
      <section class="mt-8 flex justify-end">
          <div class="w-full max-w-xs">
              <div class="bg-gray-50 rounded-lg p-4">
                  <div class="flex justify-between items-center font-bold text-lg">
                      <span class="text-gray-900">التكلفة الإجمالية</span>
                      <span class="font-mono text-primary-700">{{ inv.totalAmount | currency:'SAR':'symbol':'1.0-2' }}</span>
                  </div>
              </div>
          </div>
      </section>

      <!-- Footer -->
      <footer class="text-center text-xs text-gray-400 border-t pt-4 mt-8">
        <p>هذه الفاتورة بمثابة سجل لعملية الشراء.</p>
      </footer>
    </div>

    <div class="mt-8 text-center no-print">
      <button (click)="goBack()" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-lg shadow hover:bg-gray-300 transition duration-300 ml-4">
        &larr; رجوع
      </button>
      <button (click)="printInvoice()" class="bg-primary-600 text-white px-6 py-2 rounded-lg shadow hover:bg-primary-700 transition duration-300">
        طباعة الفاتورة
      </button>
    </div>
  } @else {
    <p class="text-center text-red-500">لم يتم العثور على فاتورة الشراء المطلوبة.</p>
  }
</div>