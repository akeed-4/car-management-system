<div class="container">
  <h2 class="page-title">إدارة موديلات السيارات</h2>

  <div class="card">
    <div class="form-section">
      <h3 class="form-section-title">إضافة موديل جديد</h3>
      <form #form="ngForm" (ngSubmit)="addCarModel()" class="add-form-grid">
        <div>
          <label for="manufacturer" class="form-label">الشركة المصنعة</label>
          <select 
            id="manufacturer"
            name="manufacturer"
            [ngModel]="selectedManufacturerId()"
            (ngModelChange)="selectedManufacturerId.set(+$event)"
            required
            class="form-select">
            <option [ngValue]="null" disabled>-- اختر الشركة --</option>
            @for(m of manufacturers(); track m.id) {
              <option [value]="m.id">{{ m.name }}</option>
            }
          </select>
        </div>
        <div>
           <label for="modelName" class="form-label">اسم الموديل</label>
           <input 
              type="text"
              id="modelName"
              name="modelName"
              placeholder="مثال: كامري"
              [ngModel]="newModelName()"
              (ngModelChange)="newModelName.set($event)"
              required
              class="form-input">
        </div>
        <button 
          type="submit" 
          [disabled]="form.invalid"
          class="btn btn-primary">
          إضافة الموديل
        </button>
      </form>
    </div>

    <h3 class="card-header">الموديلات الحالية</h3>
    <div class="table-controls">
      <input 
        type="text" 
        placeholder="ابحث عن موديل (الاسم، الشركة المصنعة...)"
        class="form-input search-input"
        (input)="onFilter($event)">
    </div>
    <div class="table-wrapper">
      <table class="table">
        <thead>
          <tr>
            <th (click)="onSort('id')"># {{ getSortIcon('id') }}</th>
            <th (click)="onSort('name')">الموديل {{ getSortIcon('name') }}</th>
            <th (click)="onSort('manufacturerName')">الشركة المصنعة {{ getSortIcon('manufacturerName') }}</th>
            <th class="actions-header">إجراءات</th>
          </tr>
        </thead>
        <tbody>
          @for (model of filteredAndSortedModels(); track model.id) {
            <tr>
              <td>{{ model.id }}</td>
              <td class="font-medium">{{ model.name }}</td>
              <td>{{ model.manufacturerName }}</td>
              <td class="actions-cell">
                  <button (click)="requestDelete(model.id)" class="btn-icon btn-icon-danger" title="حذف">
                      <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                  </button>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="4" class="empty-state">
                لم يتم إضافة أي موديلات بعد.
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>

<app-modal 
  [isOpen]="isDeleteModalOpen()" 
  title="تأكيد حذف الموديل" 
  message="هل أنت متأكد من حذف هذا الموديل؟"
  (confirm)="confirmDelete()" 
  (cancel)="closeDeleteModal()">
</app-modal>
