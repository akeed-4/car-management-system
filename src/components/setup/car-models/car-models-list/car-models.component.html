<div class="container">
  <h2 class="page-title">{{ 'CAR_MODELS.TITLE' | translate }}</h2>

  <div class="card">
    <div class="form-section">
      <h3 class="form-section-title">{{ isEditMode() ? ('CAR_MODELS.EDIT_TITLE' | translate) : ('CAR_MODELS.ADD_NEW' | translate) }}</h3>
      <form [formGroup]="carModelForm"  class="add-form-grid">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ 'CAR_MODELS.MANUFACTURER_LABEL' | translate }}</mat-label>
          <mat-select
            formControlName="manufacturerId"
            required>
            <mat-option [value]="null" disabled>{{ 'CAR_MODELS.SELECT_MANUFACTURER' | translate }}</mat-option>
            @for(m of manufacturers(); track m.id) {
              <mat-option [value]="m.id">{{ m.name }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ 'CAR_MODELS.MODEL_NAME_LABEL' | translate }}</mat-label>
          <input
            matInput
            type="text"
            formControlName="modelName"
            placeholder="{{ 'CAR_MODELS.MODEL_PLACEHOLDER' | translate }}"
            name="modelName"
            required>
        </mat-form-field>
     
      </form>
        <div class="form-actions">
          <button mat-raised-button color="primary" (click)="addCarModel()" [disabled]="carModelForm.invalid" class="btn-mat-height">
            <mat-icon>{{ isEditMode() ? 'update' : 'save' }}</mat-icon>
            {{ isEditMode() ? ('CAR_MODELS.UPDATE_BUTTON' | translate) : ('CAR_MODELS.ADD_BUTTON' | translate) }}
          </button>
          @if (isEditMode()) {
            <button mat-stroked-button (click)="cancelEdit()" class="btn-mat-height">
              <mat-icon>cancel</mat-icon>
              {{ 'CAR_MODELS.CANCEL_BUTTON' | translate }}
            </button>
          }
        </div>
    </div>

    <h3 class="card-header">{{ 'CAR_MODELS.LIST_TITLE' | translate }}</h3>
    
    @if (filteredAndSortedModels().length === 0) {
      <div class="empty-state">
        {{ 'CAR_MODELS.NO_MODELS' | translate }}
      </div>
    } @else {
      <ng-container *ngIf="cardLayout$ | async as layout">
        <mat-grid-list [cols]="layout.columns" rowHeight="120px" gutterSize="16px">
          @for (model of filteredAndSortedModels(); track model.id) {
            <mat-grid-tile [colspan]="layout.miniCard.cols" [rowspan]="layout.miniCard.rows">
              <div class="model-card">
                <div class="model-card-content">
                  <h4 class="model-name">{{ model.name }}</h4>
                  <p class="manufacturer-name">{{ model.manufacturerName }}</p>
                </div>
                <div class="model-card-actions">
                  <button
                    mat-icon-button
                    (click)="editCarModel(model)"
                    [title]="'CAR_MODELS.EDIT' | translate"
                    color="primary">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    (click)="requestDelete(model.id)"
                    [title]="'CAR_MODELS.DELETE' | translate"
                    color="warn">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            </mat-grid-tile>
          }
        </mat-grid-list>
      </ng-container>
    }
  </div>
</div>

<app-modal 
  [isOpen]="isDeleteModalOpen()" 
  title="{{ 'CAR_MODELS.DELETE_CONFIRM_TITLE' | translate }}" 
  message="{{ 'CAR_MODELS.DELETE_CONFIRM_MESSAGE' | translate }}"
  (confirm)="confirmDelete()" 
  (cancel)="closeDeleteModal()">
</app-modal>
